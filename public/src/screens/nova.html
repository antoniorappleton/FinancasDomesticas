<section class="card">
  <h2 class="section-title">Nova transação</h2>

  <!-- Tipo -->
  <div class="grid" style="grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 8px">
    <label class="btn" style="display: flex; align-items: center; gap: 8px">
      <input type="radio" name="tx-type" value="INCOME" checked />
      <span>Receita</span>
    </label>
    <label class="btn" style="display: flex; align-items: center; gap: 8px">
      <input type="radio" name="tx-type" value="EXPENSE" />
      <span>Despesa</span>
    </label>
    <label class="btn" style="display: flex; align-items: center; gap: 8px">
      <input type="radio" name="tx-type" value="SAVINGS" />
      <span>Poupança</span>
    </label>
    <label class="btn" style="display: flex; align-items: center; gap: 8px">
      <input type="radio" name="tx-type" value="TRANSFER" />
      <span>Transferência</span>
    </label>
  </div>

  <!-- Data + Valor -->
  <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px">
    <label>Data
      <input id="tx-date" type="date" />
    </label>
    <label>Valor
      <input id="tx-amount" type="number" step="0.01" inputmode="decimal" placeholder="0,00" />
    </label>
  </div>

  <!-- Conta (uma) -->
  <div id="row-account-single" class="grid" style="grid-template-columns: 1fr; gap: 10px; margin-top: 10px">
    <label>Conta
      <select id="tx-account"></select>
    </label>
  </div>

  <!-- Contas (transfer) -->
  <div id="row-account-transfer" class="grid hidden"
    style="grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px">
    <label>De
      <select id="tx-account-from"></select>
    </label>
    <label>Para
      <select id="tx-account-to"></select>
    </label>
  </div>

  <!-- Categoria -->
  <div id="row-category" style="margin-top: 10px">
    <label>
      <select id="tx-category"></select>
    </label>

    <!-- Bloco só para DESPESA -->
    <div id="exp-cat-wrap" class="hidden" style="margin-top: 8px">
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px">
        <label>Categoria (principal)
          <select id="cat-parent"></select>
        </label>
        <label>Subcategoria
          <select id="cat-child"></select>
        </label>
      </div>
      <input type="hidden" id="tx-category-exp" />
    </div>
  </div>

  <!-- Natureza (apenas Despesa) -->
  <div id="row-nature" class="grid hidden" style="grid-template-columns: 1fr; gap: 10px; margin-top: 10px">
    <label>Natureza da despesa</label>
    <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 8px">
      <label class="btn" style="display: flex; align-items: center; gap: 8px">
        <input type="radio" name="tx-nature" value="fixed" />
        <span>Fixas (habituais)</span>
      </label>
      <label class="btn" style="display: flex; align-items: center; gap: 8px">
        <input type="radio" name="tx-nature" value="variable" />
        <span>Variáveis (ocasionais)</span>
      </label>
    </div>
  </div>
  <!-- Botão agora é FAB (fora do fluxo) -->
  <button id="btn-fixed-bulk" class="btn fab-extended hidden" type="button">
    <svg aria-hidden="true" width="20" height="20">
      <use href="#i-plus"></use>
    </svg>
    <span>Despesas Rápidas</span>
  </button>

  <!-- Regularidade / Método / Estado -->
  <div class="grid" style="
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 10px;
      margin-top: 10px;
    ">
    <label>Regularidade
      <select id="tx-regularity"></select>
    </label>
    <label>Método
      <select id="tx-method"></select>
    </label>
    <label>Estado
      <select id="tx-status"></select>
    </label>
  </div>
  <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px">
    <label>Descrição
      <input id="tx-desc" type="text" placeholder="ex.: Supermercado, Ordenado, ..." />
    </label>
    <label>Localização
      <input id="tx-loc" type="text" placeholder="Opcional" />
    </label>
  </div>

  <label style="margin-top: 10px">Notas
    <textarea id="tx-notes" rows="3" placeholder="opcional"></textarea>
  </label>

  <div id="tx-msg" class="card" style="margin-top: 10px; display: none"></div>
  <div style="display: flex; gap: 10px; margin-top: 12px">
    <button id="tx-save" class="btn btn--primary">Guardar</button>
    <button id="tx-clear" class="btn">Limpar</button>
  </div>

</section>

<!-- Modal Bulk Fixed Expenses -->
<div id="fixed-bulk-modal" class="modal" hidden>
  <div class="modal__card" style="
      display: flex;
      flex-direction: column;
      max-height: 85vh;
      padding: 0;
      overflow: hidden;
    ">
    <header class="modal__header" style="
        flex-shrink: 0;
        padding: 16px;
        border-bottom: 1px solid var(--border);
      ">
      <h3 class="modal__title">Despesas fixas frequentes</h3>
      <button class="modal__close" type="button" aria-label="Fechar">×</button>
    </header>

    <div class="modal__body" style="flex: 1; overflow-y: auto; padding: 16px">
      <p class="row-note" style="margin-bottom: 12px">
        Confirma os valores para este mês.
      </p>

      <div id="fixed-bulk-list" class="bulk-list"></div>
    </div>

    <footer class="modal__footer" style="
        flex-shrink: 0;
        padding: 12px 16px;
        background: var(--bg-card);
        border-top: 1px solid var(--border);
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
      ">
      <div style="font-size: 0.9em">
        <div style="color: var(--text-sec)">Selecionado</div>
        <strong id="fixed-bulk-total" style="font-size: 1.1em; color: var(--primary)">€ 0,00</strong>
      </div>
      <div style="display: flex; gap: 10px">
        <button class="btn" id="fixed-bulk-cancel" type="button">
          Cancelar
        </button>
        <button class="btn btn--primary" id="fixed-bulk-confirm" type="button">
          Registar
        </button>
      </div>
    </footer>
  </div>
</div>