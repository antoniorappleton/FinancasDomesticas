/* =========================
   Design tokens
   ========================= */
:root {
  /* =========================
     Design tokens (Base)
     ========================= */
  --bg: #f7f9fb;
  --surface: #fff;
  --text: #0f172a;
  --muted: #64748b;
  --green-900: #064e3b;
  --green-700: #047857;
  --green-600: #059669;
  --green-500: #10b981;
  --red-500: #ef4444;
  --red-100: #fee2e2;
  --blue-500: #3b82f6;
  --blue-100: #dbeafe;
  --border: #e2e8f0;
  --ring: rgba(16, 185, 129, .25);
  --shadow-card: 0 4px 6px -1px rgba(0, 0, 0, .05), 0 2px 4px -1px rgba(0, 0, 0, .03);
  --radius: 16px;
  --income: #16a34a;
  --expense: #ef4444;
  --savings: #2563eb;
  --balance: #065f46;
  --footer-grad: linear-gradient(180deg, var(--green-900), #0b7a5d);

  /* === Custom Visuals Globals (Requested Schema) === */
  --app-bg-image: none;
  --app-bg-color: #0b1220;
  --app-bg-blur: 0px;

  --app-overlay-color: rgba(0, 0, 0, 0.35);
  /* Película */

  /* Structural UI Vars */
  --ui-card-bg: #ffffff;
  --ui-card-border: rgba(0, 0, 0, 0.12);
  --ui-card-blur: 0px;

  --ui-header-bg: rgba(15, 23, 42, 0.85);
  --ui-menu-bg: rgba(15, 23, 42, 0.90);
  --ui-fab-bg: #0ea5e9;

  /* Fonts */
  --font-body: "Inter", system-ui, -apple-system, sans-serif;
  --font-head: "Outfit", system-ui, -apple-system, sans-serif;

  --maxw: 1100px;
  --footer-h: 64px;
}

/* =========================
   Reset / Base
   ========================= */
* {
  box-sizing: border-box
}

html,
body {
  height: 100%
}

body {
  margin: 0;
  background: transparent;
  /* Permite ver body::before (-z-index) */
  color: var(--text);
  font-family: var(--font-body);
  font-size: 15px;
  line-height: 1.5;
  -webkit-font-smoothing: antialiased;
  position: relative;
  min-height: 100vh;
}

/* Camada 1: Imagem de Fundo Global */
body::before {
  content: "";
  position: fixed;
  inset: 0;
  z-index: -2;
  background-image: var(--app-bg-image);
  background-color: var(--app-bg-color);
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  background-attachment: fixed;
  filter: blur(var(--app-bg-blur));
  pointer-events: none;
}

/* Camada 2: Película (Overlay) */
body::after {
  content: "";
  position: fixed;
  inset: 0;
  z-index: -1;
  background: var(--app-overlay-color);
  pointer-events: none;
}

h1,
h2,
h3,
h4,
h5,
h6 {
  font-family: var(--font-head);
  margin: 0;
  line-height: 1.2;
  letter-spacing: -0.015em;
}

a {
  color: inherit;
  text-decoration: none
}

.hidden {
  display: none !important
}

.visually-hidden {
  position: absolute !important;
  width: 1px;
  height: 1px;
  clip: rect(1px, 1px, 1px, 1px);
  overflow: hidden;
  white-space: nowrap
}

/* =========================
   Ícones
   ========================= */
.icon {
  width: 1em;
  height: 1em;
  display: inline-block;
  display: inline-block;
  vertical-align: middle
}

/* Material Symbols Class */
.material-symbols-outlined {
  font-family: 'Material Symbols Outlined';
  font-weight: normal;
  font-style: normal;
  font-size: 24px;
  line-height: 1;
  letter-spacing: normal;
  text-transform: none;
  display: inline-block;
  white-space: nowrap;
  word-wrap: normal;
  direction: ltr;
  -webkit-font-feature-settings: 'liga';
  font-feature-settings: 'liga';
  -webkit-font-smoothing: antialiased;
}

.icon--lg {
  width: 22px;
  height: 22px
}

.foot-item__icon {
  width: 22px;
  height: 22px;
  color: #fff
}

/* =========================
   Header
   ========================= */
.app-header {
  position: sticky;
  top: 0;
  z-index: 10;
  background: var(--ui-header-bg);
  /* Theme */
  color: #fff;
  border-bottom: 1px solid rgba(255, 255, 255, .08)
}

.app-header__inner {
  max-width: 1200px;
  margin: auto;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 24px;
  padding: 14px 20px
}

.brand {
  display: flex;
  align-items: center;
  gap: 12px
}

.brand__logo {
  width: 36px;
  height: 36px;
  border-radius: 10px;
  display: grid;
  place-items: center;
  background: rgba(255, 255, 255, .12);
  box-shadow: inset 0 0 0 1px rgba(255, 255, 255, .12)
}

.brand__text {
  display: flex;
  flex-direction: column;
  justify-content: center;
  margin-left: 8px
}

.brand__title {
  font-family: var(--font-head);
  font-weight: 700;
  display: block;
  font-size: 1.25em;
  letter-spacing: -0.025em
}

.brand__subtitle {
  font-size: .9em;
  color: #e8e7e7;
  display: block
}

.top-nav {
  display: flex;
  gap: 10px
}

.top-nav__item {
  color: #e8fffa;
  font-weight: 600;
  font-size: 14px;
  padding: 8px 12px;
  border-radius: 10px;
  opacity: .95
}

.top-nav__item:hover {
  background: rgba(255, 255, 255, .12)
}

.top-nav__item--active {
  background: rgba(255, 255, 255, .18)
}

/* =========================
   Layout
   ========================= */
#app-main {
  padding: 12px 12px calc(var(--footer-h) + 18px);
  min-height: calc(100svh - var(--footer-h));
}

.outlet {
  max-width: var(--maxw);
  margin: 0 auto
}

.card {
  background: var(--ui-card-bg);
  /* Theme */
  border: 1px solid var(--ui-card-border);
  /* Theme */
  backdrop-filter: blur(var(--ui-card-blur));
  /* Theme */
  -webkit-backdrop-filter: blur(var(--ui-card-blur));
  border-radius: var(--radius);
  padding: clamp(16px, 4vw, 24px);
  box-shadow: var(--shadow-card);
  margin-bottom: 14px
}

/* SAFE INPUT LOCK for Transparent Cards */
.card:not(.no-input-lock) :where(input, select, textarea) {
  background: #fff;
  color: #111;
}

.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}

.card-body.collapsed {
  display: none;
}

.chevron-anim {
  display: inline-flex;
  transition: transform 0.2s ease;
}

.chevron-anim.rotated {
  transform: rotate(180deg);
}

.section-title {
  font-family: var(--font-head);
  font-weight: 700;
  font-size: clamp(18px, 4vw, 22px);
  margin-bottom: 16px;
  color: var(--text);
}

/* =========================
   KPI
   ========================= */
.kpi__title {
  color: var(--muted);
  font-family: var(--font-head);
  font-size: 13px;
  font-weight: 600;
  letter-spacing: .2px;
  /* igual ao toque dos títulos */
}

.kpi__value {
  font-family: var(--font-head);
  font-size: clamp(20px, 4.8vw, 28px);
  font-weight: 800;
  margin-top: 4px;
  font-variant-numeric: tabular-nums;
  /* números alinhados */
}

.kpi--income .kpi__value {
  color: var(--income)
}

.kpi--expense .kpi__value {
  color: var(--expense)
}

.kpi--savings .kpi__value {
  color: var(--savings)
}

.kpi--balance .kpi__value {
  color: var(--balance)
}

/* =========================
   Footer (único consolidado)
   ========================= */
/* === Footer compacto responsivo (5 tabs) === */

/* base: grelha fluida com auto-fit para caber 5 tabs sem partir */
.app-footer {
  position: sticky;
  bottom: 0;
  left: 0;
  right: 0;
  z-index: 40;
  width: 100%;
  height: var(--footer-h, 56px);
  /* ligeiramente mais baixo */
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(64px, 1fr));
  gap: 6px;
  padding: 6px 8px calc(max(6px, env(safe-area-inset-bottom)));
  background: var(--ui-menu-bg);
  /* Theme */
  color: #fff;
  border-top: 1px solid rgba(255, 255, 255, .08);
  box-shadow: 0 -6px 16px rgba(2, 6, 23, .15);
}

/* item mais compacto */
.foot-item {
  display: grid;
  grid-template-rows: 20px auto;
  align-content: center;
  justify-items: center;
  padding: 6px 4px;
  border-radius: 10px;
  background: rgba(255, 255, 255, .08);
  color: #e8fffa;
  font: 600 11.5px/1.1 system-ui, -apple-system, Segoe UI, Roboto;
  gap: 4px;
}

.foot-item:hover {
  background: rgba(255, 255, 255, .14)
}

.foot-item:active {
  transform: translateY(1px)
}

.foot-item[aria-current="page"] {
  background: rgba(255, 255, 255, .18);
  outline: 1px solid rgba(255, 255, 255, .18);
  color: #fff;
}

/* ícone e label mais pequenos em ecrãs apertados */
.foot-item__icon {
  width: 20px;
  height: 20px;
  color: #fff
}

.foot-item__label {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* XS: esconde labels para garantir que cabem todos sem quebrar */
@media (max-width: 380px) {
  .app-footer {
    gap: 4px;
    padding-left: 6px;
    padding-right: 6px;
  }

  .foot-item {
    grid-template-rows: 22px;
    padding: 8px 2px;
  }

  .foot-item__label {
    display: none;
  }
}

/* S: labels visíveis mas com tipografia compacta */
@media (min-width:381px) and (max-width:480px) {
  .foot-item {
    padding: 8px 4px;
  }

  .foot-item__icon {
    width: 20px;
    height: 20px;
  }

  .foot-item__label {
    font-size: 11px;
  }
}

/* M+: pode crescer um bocadinho */
@media (min-width:481px) {
  .app-footer {
    gap: 6px;
  }

  .foot-item {
    padding: 8px 6px;
  }

  .foot-item__icon {
    width: 22px;
    height: 22px;
  }

  .foot-item__label {
    font-size: 12px;
  }
}


/* =========================
   Auth overlay (único)
   ========================= */
/* =========================
   Auth overlay (único)
   ========================= */
.auth-overlay {
  position: fixed;
  inset: 0;
  display: grid;
  place-items: start center;
  padding: clamp(8px, 2vw, 16px);
  background: rgba(0, 0, 0, .12);
  backdrop-filter: blur(3px);
  overflow: auto;
  z-index: 999;
}

/* STRICT PROTECTION: Login must be white/opaque */
.auth-card {
  background: #ffffff !important;
  color: #111827 !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  filter: none !important;
  /* Original structure props */
  border: 1px solid var(--border);
  border-radius: 16px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, .12);
  padding: 20px;
  width: min(92vw, 420px);
  margin-top: 6vh;
}

/* STRICT PROTECTION: Help Containers */
#help-pop,
.help-box,
.screen-help,
.help-container {
  background: #fff7cc !important;
  color: #000000 !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  filter: none !important;
}

/* =========================
   Form / Botões base
   ========================= */
label {
  display: flex;
  flex-direction: column;
  gap: 6px;
  margin-bottom: 10px;
  font-weight: 500;
  font-size: 14px;
  color: var(--text)
}

input,
select,
textarea {
  border: 1px solid #cbd5e1;
  border-radius: 12px;
  padding: 12px 14px;
  font-family: var(--font-body);
  font-size: 16px;
  /* evita zoom no iOS */
  transition: border-color .15s, box-shadow .15s;
}

textarea {
  min-height: 80px;
  resize: vertical
}

.btn {
  border: 1px solid #cbd5e1;
  padding: 10px 12px;
  border-radius: 10px;
  background: #fff;
  cursor: pointer
}

.btn--primary {
  background: #065f46;
  color: #fff;
  border-color: #065f46
}

.link {
  background: transparent;
  border: 0;
  padding: 0;
  color: #0ea5e9;
  cursor: pointer
}

/* Acessibilidade */
a:focus,
button:focus,
input:focus,
select:focus,
textarea:focus {
  outline: 2px solid var(--ring);
  outline-offset: 2px;
}

/* =========================
   Grids utilitárias
   ========================= */
.grid {
  display: grid;
  gap: 12px
}

.grid.kpi {
  grid-template-columns: repeat(2, minmax(0, 1fr))
}

@media (min-width:900px) {
  .grid.kpi {
    grid-template-columns: repeat(4, minmax(0, 1fr))
  }
}

/* =========================
   Charts (único consolidado)
   ========================= */
.chart {
  position: relative;
  width: 100%;
  height: clamp(220px, 38vh, 360px)
}

.chart--tall {
  height: clamp(260px, 45vh, 420px)
}

.chart--short {
  height: clamp(180px, 32vh, 300px)
}

/* Canvas ocupa o contentor em qualquer contexto */
.chart>canvas,
.card canvas,
#report-overlay canvas {
  width: 100% !important;
  height: 100% !important;
  display: block;
}

/* =========================
   Forms responsivos (páginas)
   ========================= */
.form-grid {
  display: grid;
  gap: 12px;
  grid-template-columns: 1fr
}

@media (min-width:700px) {
  .form-grid {
    grid-template-columns: 1fr 1fr
  }
}

label {
  display: grid;
  gap: 6px;
  font-size: 14px
}

input[type="text"],
input[type="number"],
input[type="date"],
select,
textarea {
  width: 100%;
  padding: 10px 12px;
  border: 1px solid #cbd5e1;
  border-radius: 10px;
  font: inherit;
}

.actions {
  display: flex;
  gap: 8px;
  flex-wrap: wrap
}

.actions .btn {
  flex: 1 1 auto
}

.card--sticky-footer {
  position: sticky;
  bottom: 0;
  z-index: 5;
  z-index: 5;
  background: var(--card-bg);
  backdrop-filter: blur(var(--card-blur));
  border-top: 1px solid var(--border);
  padding: 10px 12px
}

/* =========================
   Modal base (único)
   ========================= */
.modal[hidden] {
  display: none !important
}

.modal__card {
  width: min(92vw, 640px);
  max-height: 90vh;
  overflow: auto;
  background: var(--card-bg);
  color: var(--text);
  border: 1px solid var(--border);
  border-radius: 14px;
  box-shadow: 0 24px 60px rgba(2, 6, 23, .25);
  padding: 16px;
}

.modal__header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 8px;
  margin-bottom: 10px
}

.modal__title {
  font-family: var(--font-head);
  font-weight: 700;
  font-size: clamp(18px, 4vw, 20px)
}

.modal__close {
  background: transparent;
  border: 0;
  font-size: 22px;
  cursor: pointer
}

.badge-muted {
  font-size: 12px;
  color: var(--text)
}

.row-note {
  font-size: 12px;
  color: var(--text);
}

/* =========================
   Modal de Transações (B/N específico)
   ========================= */
#tx-edit-modal.modal {
  align-items: flex-start;
  justify-content: center;
  padding: 24px;
  background: rgba(0, 0, 0, .55);
  z-index: 1000;
}

#tx-edit-modal[hidden] {
  display: none
}

#tx-edit-modal .modal__card {
  width: min(1100px, 92vw);
  max-height: 92vh;
  background: var(--card-bg);
  color: #111;
  border: 1px solid #e5e7eb;
  border-radius: 16px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, .25);
  overflow: auto;
}

#tx-edit-modal .modal__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  padding: 14px 16px;
  border-bottom: 1px solid #e5e7eb;
  padding: 14px 16px;
  border-bottom: 1px solid #e5e7eb;
  background: var(--card-bg);
  color: #111;
}

#tx-edit-modal .modal__title {
  font-weight: 700;
  font-size: 16px;
  color: #111
}

#tx-edit-modal .badge-muted {
  color: #6b7280
}

#tx-edit-modal .modal__close {
  border: none;
  background: transparent;
  cursor: pointer;
  font-size: 22px;
  line-height: 1;
  color: #111
}

#tx-edit-modal .modal__close:hover {
  opacity: .7
}

#tx-edit-modal .form-grid {
  padding: 12px 16px
}

#tx-edit-modal .form-grid label {
  display: grid;
  gap: 6px;
  color: #111
}

#tx-edit-modal .form-grid input,
#tx-edit-modal .form-grid select,
#tx-edit-modal .form-grid textarea {
  background: #fff;
  color: #111;
  border: 1px solid #d1d5db;
  border-radius: 10px;
  padding: 10px 12px;
  outline: none;
}

#tx-edit-modal .form-grid textarea {
  min-height: 88px;
  resize: vertical
}

#tx-edit-modal .form-grid input:focus,
#tx-edit-modal .form-grid select:focus,
#tx-edit-modal .form-grid textarea:focus {
  border-color: #111;
  box-shadow: 0 0 0 3px rgba(17, 17, 17, .09);
}

#tx-edit-modal .actions {
  padding: 0 16px 16px;
  border-top: 1px solid #e5e7eb;
  padding: 0 16px 16px;
  border-top: 1px solid #e5e7eb;
  background: var(--card-bg);
}

#tx-edit-modal .modal__card::-webkit-scrollbar {
  width: 10px
}

#tx-edit-modal .modal__card::-webkit-scrollbar-thumb {
  background: #d1d5db;
  border-radius: 10px
}

#tx-edit-modal .modal__card::-webkit-scrollbar-track {
  background: transparent
}

#tx-edit-modal :focus-visible {
  outline: 2px solid #111;
  outline-offset: 2px
}

@media print {
  #tx-edit-modal.modal {
    position: static;
    background: #fff;
    padding: 0
  }

  #tx-edit-modal .modal__card {
    width: auto;
    max-height: none;
    box-shadow: none;
    border: none
  }

  #tx-edit-modal .actions,
  #tx-edit-modal .modal__close {
    display: none
  }
}

/* =========================
   Report Modal (único)
   ========================= */

.rep-overlay {
  position: fixed;
  inset: 0;
  z-index: 9999;
  display: none;
  align-items: flex-start;
  justify-content: center;
  padding: 24px;
  background: rgba(2, 8, 23, .6);
  overflow-y: auto;
}

.rep-overlay:not(.hidden) {
  display: flex
}

.rep-modal {
  width: min(980px, 100%);
  max-height: calc(100vh - 48px);
  background: #fff;
  color: #0f172a;
  border-radius: 12px;
  box-shadow: 0 20px 40px rgba(0, 0, 0, .25);
  display: flex;
  flex-direction: column;
}

.rep-header {
  position: sticky;
  top: 0;
  z-index: 1;
  background: #fff;
  padding: 12px 16px;
  border-bottom: 1px solid #e5e7eb;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.rep-body {
  padding: 16px;
  overflow: auto;
  display: flex;
  flex-direction: column;
  gap: 12px
}

.rep-footer {
  background: #fff;
  border-top: 1px solid #e5e7eb
}

.icon-btn {
  background: transparent;
  border: none;
  padding: 6px 8px;
  font-size: 18px;
  line-height: 1;
  cursor: pointer;
  border-radius: 8px
}

.icon-btn:focus-visible {
  outline: 2px solid #2563EB;
  outline-offset: 2px
}

.rpt-kpis {
  grid-template-columns: repeat(4, minmax(0, 1fr));
  gap: 10px
}

.kpi {
  background: #f8fafc;
  border-radius: 12px;
  padding: 12px
}

.kpi__label {
  color: #64748b;
  font-size: .8rem
}

.kpi__value {
  font-weight: 700;
  font-size: 1.1rem
}

.rpt-legend {
  display: flex;
  flex-direction: column;
  gap: 6px;
  margin-top: 8px
}

.rpt-legend__item {
  display: flex;
  align-items: center;
  gap: 8px
}

.rpt-legend__dot {
  width: 10px;
  height: 10px;
  border-radius: 999px;
  display: inline-block
}

.header-row {
  display: flex;
  align-items: flex-end;
  justify-content: space-between;
  gap: 12px;
  margin-bottom: 8px
}

.muted {
  color: #64748B
}

/* grid e wrappers do relatório */
.rep-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  padding: 12px 16px;
  margin: -16px -20px 12px;
  /* cola ao topo da .rpt-modal */
  border-bottom: 1px solid #e5e7eb;
  background: #fff;
}

.rep-title {
  display: flex;
  align-items: center;
  gap: 10px;
  min-width: 0;
}

.rep-title h2 {
  font-size: 1.1rem;
  font-weight: 800;
  margin: 0;
  line-height: 1.1;
}

.rep-title img {
  height: 1.1em;
  width: auto;
  display: inline-block;
  vertical-align: baseline;
}

/* o teu .rpt-close estava absolute; para este header ficar direitinho: */
.rep-header .rpt-close {
  position: static;
  font-size: 22px;
  line-height: 1;
  background: transparent;
  border: 0;
  cursor: pointer;
}

.rpt-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 12px
}

@media (min-width:900px) {
  .rpt-grid {
    grid-template-columns: 1fr 1fr
  }
}

.chart-wrap {
  position: relative;
  width: 100%;
  height: 260px;
  border: 1px solid var(--border);
  border-radius: 12px;
  background: var(--card-bg);
}

.chart-wrap canvas {
  position: absolute;
  inset: 0;
  width: 100% !important;
  height: 100% !important
}

.chart-wrap--series {
  height: 300px
}

#report-overlay .modal__card {
  width: min(980px, 96vw);
  max-height: 92vh;
  overflow: auto;
  padding: 16px;
  background: var(--card-bg);
  /* modal glass */
  backdrop-filter: blur(20px);
}

#rpt-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px
}

@media (max-width:740px) {
  #rpt-grid {
    grid-template-columns: 1fr
  }
}

.rpt-canvas-box {
  height: 240px;
  min-height: 240px
}

#rpt-series-box {
  height: 260px;
  min-height: 260px
}

#rpt-cat-legend {
  max-height: 260px;
  overflow: auto;
  padding-right: 8px
}

/* =========================
   Filtros Transações + Tabela
   ========================= */
.filters-grid {
  display: grid;
  grid-template-columns: 1fr minmax(140px, 200px) minmax(160px, 220px) minmax(160px, 220px);
  gap: 12px;
  align-items: end;
}

.filters-grid>* {
  min-width: 0
}

.filters-grid input,
.filters-grid select {
  width: 100%
}

.filters-grid input[type="month"] {
  height: 38px;
  padding: 8px 10px;
  line-height: 1.2
}

@media (max-width:900px) {
  .filters-grid {
    grid-template-columns: 1fr 1fr
  }
}

@media (max-width:520px) {
  .filters-grid {
    grid-template-columns: 1fr
  }
}

.card .actions {
  display: flex;
  gap: 8px;
  flex-wrap: wrap
}

table {
  width: 100%;
  border-collapse: collapse
}

th,
td {
  white-space: nowrap
}

td:nth-child(5) {
  max-width: 280px;
  overflow: hidden;
  text-overflow: ellipsis
}

@media (max-width:520px) {
  td:nth-child(5) {
    max-width: 160px
  }
}

/* =========================
   Listas de categoria (duas variações)
   ========================= */
/* Variante 1 (id) */
#cat-list {
  display: flex;
  flex-direction: column;
  gap: 12px
}

#cat-list .cat-item {
  --border: #e5e7eb;
  --bg: #fff;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  padding: 14px 16px;
  padding: 14px 16px;
  border: 1px solid var(--border);
  border-radius: 14px;
  background: var(--card-bg);
  transition: box-shadow .15s ease, border-color .15s ease, transform .05s ease;
}

#cat-list .cat-item:hover {
  box-shadow: 0 6px 20px rgba(0, 0, 0, .06);
  border-color: #d1d5db
}

#cat-list .cat-left {
  display: flex;
  align-items: center;
  gap: 12px;
  min-width: 0
}

#cat-list .cat-dot {
  width: 10px;
  height: 10px;
  border-radius: 999px;
  flex: 0 0 10px
}

#cat-list .cat-name {
  font-weight: 600;
  line-height: 1.2
}

#cat-list .cat-meta {
  font-size: 12px;
  color: #6b7280;
  margin-top: 2px
}

#cat-list .cat-right {
  text-align: right
}

#cat-list .cat-amount {
  font-weight: 700
}

#cat-list .cat-avg {
  font-size: 12px;
  color: #6b7280;
  margin-top: 2px
}

@media (max-width:640px) {
  #cat-list .cat-item {
    padding: 12px
  }

  #cat-list .cat-name {
    font-size: 14px
  }

  #cat-list .cat-amount {
    font-size: 14px
  }
}

/* Variante 2 (classe genérica) */
.cat-list {
  display: grid;
  gap: 12px
}

.cat-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 16px;
  border: 1px solid var(--card-border, #e5e7eb);
  background: var(--card-bg);
  border-radius: 14px;
}

.cat-left {
  display: grid;
  grid-template-columns: auto 1fr;
  column-gap: 12px;
  row-gap: 4px;
  align-items: center
}

.cat-dot {
  width: 10px;
  height: 10px;
  border-radius: 999px
}

.cat-title {
  font-weight: 600;
  line-height: 1
}

.cat-sub {
  grid-column: 2;
  color: #6b7280;
  font-size: .9rem
}

.cat-right {
  text-align: right
}

.cat-amount {
  font-weight: 700
}

.cat-month {
  font-size: .85rem;
  color: #6b7280
}

@media (max-width:640px) {
  .cat-item {
    padding: 12px
  }
}

/* =========================
   Toggles, badges, pills
   ========================= */
.toggle {
  display: flex;
  align-items: center;
  gap: 8px;
  white-space: nowrap
}

.toggle input {
  margin: 0
}

.badge {
  display: inline-block;
  padding: 2px 8px;
  border-radius: 999px;
  font-size: .75rem;
  font-weight: 700;
  line-height: 1
}

.badge-user {
  background: #16a34a;
  color: #fff
}

.badge-system {
  background: #6b7280;
  color: #fff
}

.pill {
  display: inline-block;
  padding: 2px 8px;
  border-radius: 999px;
  font-size: .75rem;
  font-weight: 700
}

.pill--expense {
  background: #f97316;
  color: #fff
}

.pill--income {
  background: #10b981;
  color: #fff
}

.pill--save {
  background: #2563EB;
  color: #fff
}

/* =========================
   Grids helpers extra
   ========================= */
.grid-3 {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 12px
}

.col-span-3 {
  grid-column: 1 / -1
}

@media (max-width:720px) {
  .grid-3 {
    grid-template-columns: 1fr
  }
}

.obj-suggs-grid {
  display: grid;
  gap: 12px;
  grid-template-columns: repeat(2, minmax(0, 1fr));
}

@media (max-width:800px) {
  .obj-suggs-grid {
    grid-template-columns: 1fr;
  }
}

.sugg-card {
  border: 1px solid var(--border);
  background: var(--card-bg);
  border-radius: 14px;
  padding: 14px;
  box-shadow: var(--shadow-card);
  display: grid;
  gap: 8px;
}

.sugg-head {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.sugg-title {
  font-weight: 700;
}

.sugg-bars {
  position: relative;
  height: 10px;
  border-radius: 999px;
  background: #e2e8f0;
  overflow: hidden;
}

.sugg-bar-avg {
  position: absolute;
  inset: 0;
  width: 0%;
  background: #93c5fd;
}

.sugg-bar-cur {
  position: absolute;
  inset: 0;
  width: 0%;
  background: #3b82f6;
}

.sugg-meta {
  font-size: 12px;
  color: #475569;
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
}

.sugg-btn {
  border: 1px solid #cbd5e1;
  padding: 6px 10px;
  border-radius: 10px;
  background: #fff;
  cursor: pointer;
}

.sugg-btn:hover {
  background: #f8fafc;
}

/* === Help FAB + Popover (mobile-friendly, acima do footer) === */
.help-fab {
  position: fixed;
  /* ANTES: top: 76px;  =>  AGORA: fixa no canto inferior direito */
  bottom: calc(var(--footer-h, 64px) + 14px);
  right: 12px;
  z-index: 1000;
  /* sobe acima do footer */
  width: 42px;
  height: 42px;
  /* ligeiro aumento para toque */
  border-radius: 999px;
  display: grid;
  place-items: center;
  background: #fff;
  color: var(--text);
  border: 1px solid var(--border);
  box-shadow: var(--shadow-card);
}

.help-fab svg {
  width: 22px;
  height: 22px
}

/* Popover aparece logo acima do botão, alinhado à direita */
.help-pop {
  position: fixed;
  bottom: calc(var(--footer-h, 64px) + 64px);
  /* 64px acima do footer */
  right: 12px;
  z-index: 1000;
  width: min(92vw, 420px);
  max-height: 60vh;
  overflow: auto;
  max-height: 60vh;
  overflow: auto;
  background: var(--card-bg);
  color: var(--text);
  border: 1px solid var(--border);
  border-radius: 12px;
  box-shadow: var(--shadow-card);
  padding: 12px;
  backdrop-filter: blur(var(--card-blur));
}

.help-pop h3 {
  margin: 0 0 6px 0;
  font-size: 14px;
  font-weight: 800
}

.help-pop p {
  margin: 6px 0;
  color: var(--muted);
  font-size: 14px;
  line-height: 1.35
}

.help-pop .close {
  margin-top: 10px;
  display: inline-block;
  font-size: 13px;
  background: #111827;
  color: #e5e7eb;
  border: 1px solid #111827;
  border-radius: 10px;
  padding: 6px 10px;
}

/* segurança em ecrãs muito pequenos: encosta mais ao rodapé */
@media (max-height: 560px) {
  .help-fab {
    bottom: calc(var(--footer-h, 64px) + 8px)
  }

  .help-pop {
    bottom: calc(var(--footer-h, 64px) + 54px)
  }
}

/* === Splash overlay (mín. 3s) === */
.wb-splash {
  position: fixed;
  inset: 0;
  z-index: 100000;
  display: grid;
  place-items: center;
  background: var(--footer-grad);
  /* mesmo gradiente do header/footer */
}

.wb-splash__box {
  display: grid;
  place-items: center;
  gap: 12px;
  transform: translateY(0);
  animation: wb-pop 400ms ease-out both;
}

.wb-splash__logo {
  width: 96px;
  height: 96px;
  border-radius: 20px;
  box-shadow: 0 10px 30px rgba(2, 6, 23, .35);
}

.wb-splash__brand {
  color: #fff;
  font-weight: 800;
  letter-spacing: .25px;
}

@keyframes wb-pop {
  from {
    opacity: 0;
    transform: translateY(10px) scale(.98)
  }

  to {
    opacity: 1;
    transform: translateY(0) scale(1)
  }
}

/* fade-out suave */
.wb-splash.is-hiding {
  animation: wb-fade .45s ease-out both
}

@keyframes wb-fade {
  to {
    opacity: 0;
    visibility: hidden
  }
}

/* === Footer: tabs “limpos” + bolha exterior no item ativo (sem caixas nem limites) === */

/* 1) Itens sem fundos/limites, nem outline */
.foot-item {
  background: transparent !important;
  border: none !important;
  outline: none !important;
  box-shadow: none !important;
}

.foot-item:hover {
  background: transparent !important;
}

.foot-item:active {
  transform: none;
}

.foot-item:focus,
.foot-item:focus-visible {
  outline: none !important;
}

/* ícones/labels sempre brancos (um pouco menos intensos quando inativos) */
.foot-item__icon {
  color: rgba(255, 255, 255, .85);
  transition: transform .2s ease, color .2s ease;
}

.foot-item__label {
  color: #fff;
}

/* 2) Remover o realce antigo do ativo (era um fundo/outline) */
.foot-item[aria-current="page"] {
  background: transparent !important;
  outline: none !important;
  position: relative;
  color: #fff;
}

/* 3) “Curve Outside”: bolha branca que sai para FORA do footer */
.foot-item[aria-current="page"]::before {
  content: "";
  position: absolute;
  left: 50%;
  top: -22px;
  transform: translateX(-50%);
  width: 56px;
  height: 56px;
  background: #fff;
  border-radius: 999px;
  box-shadow: 0 10px 24px rgba(2, 6, 23, .20);
  z-index: 0;
  /* atrás do ícone/label, acima do fundo do footer */
}

/* ponte curva que liga a bolha ao pill do footer */
.foot-item[aria-current="page"]::after {
  content: "";
  position: absolute;
  left: 50%;
  top: 0;
  transform: translateX(-50%);
  width: 50px;
  height: 22px;
  background: #fff;
  border-bottom-left-radius: 999px;
  border-bottom-right-radius: 999px;
  z-index: 0;
}

/* 4) ícone do ativo sobe um pouco e ganha azul (sem caixas) */
.foot-item[aria-current="page"] .foot-item__icon {
  color: var(--blue-500);
  transform: translateY(-10px);
  position: relative;
  z-index: 1;
}

.foot-item[aria-current="page"] .foot-item__label {
  position: relative;
  z-index: 1;
}

/*============*/
/* ==FOOTER==*/
/*============*/

/* === FAB menu responsivo (tamanhos com clamp) === */
:root {
  /* tamanho dos itens e do arco (auto-responsivo) */
  --fab-item-d: clamp(54px, 8vw, 66px);
  --fab-gap: 18px;
  /* usado para labels/margens */
  --fab-arc-radius: clamp(110px, 24vw, 180px);
  /* raio do arco */
  --fab-arc-spread: 160deg;
  /* “abertura” do leque (0–180) */
}

/* (mantém as tuas regras atuais do .fab-nav, .fab-nav__toggle, .fab-nav__items, .fab-item, .fab-label) */


/* botão principal */
/* --- FAB core --- */
.fab-nav {
  position: fixed;
  left: 50%;
  bottom: max(16px, env(safe-area-inset-bottom));
  transform: translateX(-50%);
  z-index: 1200;
}

.fab-nav__toggle {
  width: clamp(64px, 9.5vw, 76px);
  height: clamp(64px, 9.5vw, 76px);
  border-radius: 999px;
  display: grid;
  place-items: center;
  background: var(--ui-fab-bg);
  /* Theme */
  color: #fff;
  border: none;
  cursor: pointer;
  box-shadow: 0 8px 20px rgba(2, 6, 23, .25);
}

.fab-nav__toggle svg {
  width: 28px;
  height: 28px;
  transition: transform .35s ease;
}

.fab-nav.is-open .fab-nav__toggle svg {
  transform: rotate(180deg);
}

/* Wrapper não intercepta cliques, mas os itens sim */
.fab-nav__items {
  position: absolute;
  inset: 0;
  pointer-events: none;
  /* o wrapper não apanha cliques */
}

/* Cada item é absoluto e clicável */
.fab-item {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  /* colado ao centro por defeito */
  width: clamp(54px, 8vw, 66px);
  height: clamp(54px, 8vw, 66px);
  border-radius: 999px;
  display: grid;
  place-items: center;
  background: var(--ui-fab-bg);
  /* Theme */
  color: #fff;
  border: 0;
  box-shadow: 0 10px 22px rgba(2, 6, 23, .22);
  opacity: 0;
  pointer-events: none;
  /* fechados por defeito */
  transition: transform .45s cubic-bezier(.22, .8, .24, 1),
    opacity .25s ease;
  will-change: transform;
}

.fab-item svg {
  width: 24px;
  height: 24px;
}

/* Quando aberto, TODOS ficam visíveis e clicáveis */
.fab-nav.is-open .fab-item {
  opacity: 1;
  pointer-events: auto;
}

/* Etiquetas: fundo branco, texto verde, por cima dos botões */
.fab-label {
  position: absolute;
  bottom: 100%;
  transform: translate(-50%, -10px);
  left: 50%;
  white-space: nowrap;
  background: #fff;
  color: #0b7a5d;
  font-weight: 800;
  font-size: .9rem;
  padding: 6px 10px;
  border-radius: 999px;
  box-shadow: 0 8px 20px rgba(2, 6, 23, .18);
  opacity: 0;
  pointer-events: none;
  transition: opacity .2s ease;
}

/* Mostra a etiqueta no “open” e quando o dedo está por cima */
.fab-nav.is-open .fab-item:focus .fab-label,
.fab-nav.is-open .fab-item:hover .fab-label {
  opacity: 1;
}

/* SEMPRE mostra labels quando menu está aberto */
.fab-nav.is-open .fab-label {
  opacity: 1 !important;
}

.fab-nav.is-open .fab-label {
  opacity: 1 !important;
}

/* Se quiseres etiqueta por baixo: adiciona .below no span */
.fab-label.below {
  bottom: auto;
  top: 100%;
  transform: translate(-50%, 10px);
}

/* ---- Cards colapsáveis ---- */
.card[data-collapsible] {
  position: relative;
  padding-top: 14px;
  /* espaço p/ o toggle sem mexer no header */
}

.card__toggle {
  position: absolute;
  top: 10px;
  right: 10px;
  background: transparent;
  border: 1px solid var(--border);
  width: 30px;
  height: 30px;
  display: grid;
  place-items: center;
  border-radius: 10px;
  cursor: pointer;
}


.card__toggle {
  position: absolute;
  top: 10px;
  right: 10px;
  width: 30px;
  height: 30px;
  display: grid;
  place-items: center;
  border: 1px solid var(--border);
  border-radius: 10px;
  background: #fff;
  cursor: pointer;
  box-shadow: var(--shadow-card);
}

.card__toggle svg {
  width: 18px;
  height: 18px;
  opacity: .85
}

.card__toggle:focus-visible {
  outline: 2px solid var(--ring);
  outline-offset: 2px
}

/* wrapper que abre/fecha suavemente */
.card__content {
  display: grid;
  grid-template-rows: 1fr;
  overflow: hidden;
  transition: grid-template-rows .22s ease, opacity .18s ease, padding .18s ease;
}

.card__content>* {
  min-height: 0
}


/* Semáforo para próximas despesas */
.cat-item.ok {
  border-left: 3px solid #94a3b8;
}

/* cinza/ok */
.cat-item.warn {
  border-left: 3px solid #facc15;
  background: rgba(250, 204, 21, 0.08);
}

/* amarelo suave */
.cat-item.danger {
  border-left: 3px solid #ef4444;
  background: rgba(239, 68, 68, 0.08);
}

/* encarnado suave */

/* opcional: dar um toque no meta quando é urgente */
.cat-item.danger .cat-meta {
  font-weight: 600;
}



/* -------- Mini-cards layout -------- */
.dash-mini {
  display: flex;
  gap: 12px;
  width: 100%;
}



/* -------- Generic Carousel -------- */
.carousel-container {
  position: relative;
  overflow: hidden;
  width: 100%;
  border-radius: 12px;
}

.carousel-track {
  display: flex;
  transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  width: 100%;
}

.carousel-item {
  flex: 0 0 100%;
  /* Default: 1 per view */
  padding: 6px;
  box-sizing: border-box;
}

@media (min-width: 600px) {
  .carousel-item {
    flex: 0 0 50%;
    /* 2 per view on larger screens */
  }
}

/* Overrides for Multi-Card Carousels (Quick Analysis & Upcoming) */
.mini-carousel .carousel-item,
.upcoming-carousel .carousel-item {
  min-width: 0;
  /* Width controlled by JS inline styles */
}

.carousel-dots {
  display: flex;
  justify-content: center;
  gap: 6px;
  margin-top: 10px;
  margin-bottom: 4px;
}

.carousel-dot {
  width: 7px;
  height: 7px;
  background: #cbd5e1;
  border-radius: 50%;
  cursor: pointer;
  transition: all 0.3s ease;
}

.carousel-dot.active {
  background: var(--primary);
  transform: scale(1.3);
  width: 14px;
  border-radius: 4px;
}

/* Upcoming Card Styles */
.upcoming-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 12px;
  display: flex;
  flex-direction: column;
  gap: 8px;
  box-shadow: var(--shadow-card);
  height: 100%;
  /* fill carousel item */
  transition: transform 0.2s ease;
}

.upcoming-card:hover {
  border-color: var(--primary);
}

.uc-header {
  display: flex;
  gap: 12px;
  align-items: center;
}

.uc-date {
  display: flex;
  flex-direction: column;
  align-items: center;
  background: var(--bg-card);
  border-radius: 8px;
  padding: 6px 10px;
  min-width: 48px;
}

.uc-day {
  font-weight: 800;
  font-size: 1.2rem;
  line-height: 1;
  color: var(--text);
}

.uc-month {
  font-size: 0.7rem;
  text-transform: uppercase;
  color: var(--text-sec);
  font-weight: 600;
}

.uc-info {
  display: flex;
  flex-direction: column;
  overflow: hidden;
  flex: 1;
}

.uc-cat {
  font-size: 0.85rem;
  font-weight: 600;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  color: var(--text);
}

.uc-amount {
  font-size: 0.95rem;
  font-weight: 700;
  color: var(--primary);
}

.uc-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 4px;
}

.badge {
  font-size: 0.7rem;
  padding: 2px 8px;
  border-radius: 6px;
  font-weight: 600;
}

.badge-ok {
  background: #dcfce7;
  color: #15803d;
}

.badge-warn {
  background: #fef08a;
  color: #854d0e;
}

.badge-danger {
  background: #fee2e2;
  color: #991b1b;
}

.uc-smart {
  font-size: 0.7rem;
  color: #8b5cf6;
  font-weight: 600;
  background: #f5f3ff;
  padding: 1px 6px;
  border-radius: 4px;
}

.mini-card {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  justify-content: center;
  padding: 12px 12px;
  background: #ffffff !important; /* Bulletproof: Always white */
  border: 1px solid #e2e8f0 !important; /* Bulletproof: Soft border */
  border-radius: 12px;
  box-shadow: 0 2px 6px rgba(0, 0, 0, .05);
  cursor: pointer;
  transition: transform .15s ease, box-shadow .15s ease;
  min-height: 74px;
}

.mini-card:active {
  transform: translateY(1px)
}

.mini-card__title {
  font-weight: 700;
  font-size: 13px;
  line-height: 1.1;
  color: #0f172a !important; /* Bulletproof: Always dark */
}

.mini-card__hint {
  font-size: 12px;
  color: #64748b !important; /* Bulletproof: Muted but legible */
  margin-top: 4px
}


/* STRICT PROTECTION: Force CONTENT to be White/Opaque */
/* Modais Funcionais (Popup) devem ter fundo branco e texto escuro */
.modal__card,
.rpt-modal,
#obj-edit-modal .modal__card {
  background: #ffffff !important;
  color: #111827 !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  filter: none !important;
}

/* Escopa este estilo para o(s) modais que realmente queres em “sheet” */
/* Ex.: se for só para o obj-edit modal, usa #obj-edit-modal em vez de .modal */
.modal--sheet {
  position: fixed;
  inset: 0;
  display: grid;
  place-items: end center;
  background: rgba(15, 23, 42, .4);
  z-index: 1000;
  padding: 16px;
  backdrop-filter: blur(2px);
}

/* Mantém o comportamento padrão centrado para os restantes modais */
.modal {
  position: fixed;
  inset: 0;
  display: grid;
  place-items: center;
  background: rgba(15, 23, 42, .4);
  z-index: 2000;
  padding: 16px;
  backdrop-filter: blur(2px);
}

.modal__card {
  width: min(920px, 100%);
  background: #fff;
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 0 20px 50px rgba(2, 6, 23, .4);
  max-height: calc(100vh - 32px);
  display: flex;
  flex-direction: column;
}

.modal__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
  padding: 12px 16px;
  border-bottom: 1px solid #e5e7eb;
}

.modal__title {
  font-weight: 800;
  font-size: 16px
}

.modal__close {
  background: transparent;
  border: 0;
  font-size: 22px;
  line-height: 1;
  cursor: pointer;
  padding: 4px 8px;
}

.chart {
  position: relative;
  height: 280px;
}

.chart--tall {
  height: 360px;
}

.chart canvas {
  position: absolute;
  inset: 0;
  width: 100% !important;
  height: 100% !important
}

/* legend list */
.rpt-legend {
  display: grid;
  gap: 6px
}

.rpt-legend__item {
  display: flex;
  align-items: center;
  gap: 8px
}

.rpt-legend__item strong {
  font-variant-numeric: tabular-nums
}

/* Handlers for mini-card contents */

.mini-card__close {
  position: absolute;
  top: 6px;
  right: 6px;
  width: 22px;
  height: 22px;
  border: 0;
  border-radius: 8px;
  background: #f1f5f9;
  font-weight: 700;
  line-height: 1;
  cursor: pointer;
  opacity: .85;
}

.mini-card__close:hover {
  opacity: 1;
}

.mini-shelf__chip {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  border: 1px solid #e5e7eb;
  border-radius: 999px;
  padding: 6px 10px;
  background: #f8fafc;
  font-size: 14px;
}

.mini-shelf__chip button {
  border: 0;
  background: #111827;
  color: #e5e7eb;
  border-radius: 14px;
  padding: 4px 8px;
  cursor: pointer;
}

#pf-card {
  margin-top: 24px;
}

#pf-list .cat-card {
  background: #fff;
  border-radius: 8px;
  padding: 12px;
  margin-top: 10px;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
}

.cat-card__title {
  font-weight: 600;
}

.cat-card__subtitle {
  color: #475569;
  font-size: 0.9rem;
}

/* Overlay do modal */
#obj-edit-modal.modal {
  position: fixed;
  inset: 0;
  display: grid;
  place-items: center;
  background: rgba(0, 0, 0, .45);
  z-index: 50;
}

#obj-edit-modal[hidden] {
  display: none;
}

/* Cartão do modal: coluna, com altura limitada ao ecrã */
#obj-edit-modal .modal__card {
  width: min(640px, calc(100svw - 24px));
  max-height: var(--vh, 100dvh);
  /* usa o fix JS para iOS */
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, .25);
  display: flex;
  flex-direction: column;
  overflow: hidden;
  /* impede “sangrar” ao rolar */
}

/* Header fixo */
#obj-edit-modal .modal__header {
  position: sticky;
  top: 0;
  z-index: 1;
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 12px 16px;
  background: #fff;
  border-bottom: 1px solid #e5e7eb;
}

#obj-edit-modal .modal__title {
  flex: 1;
}

#obj-edit-modal .modal__close {
  appearance: none;
  border: 0;
  background: transparent;
  font-size: 20px;
  line-height: 1;
  padding: 6px 8px;
  cursor: pointer;
}

/* Corpo rolável (o teu .form-grid) */
#obj-edit-modal .form-grid {
  flex: 1 1 auto;
  min-height: 0;
  /* essencial p/ overflow funcionar em flex */
  overflow: auto;
  padding: 16px;
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 12px;
}

#obj-edit-modal .form-grid label {
  display: flex;
  flex-direction: column;
  gap: 6px;
  font-size: 14px;
}

#obj-edit-modal .form-grid textarea {
  min-height: 96px;
  resize: vertical;
}

/* Footer fixo/sticky com safe-area */
#obj-edit-modal .actions {
  position: sticky;
  bottom: 0;
  z-index: 1;
  display: flex;
  gap: 10px;
  align-items: center;
  padding: 12px 16px calc(12px + env(safe-area-inset-bottom));
  background: #fff;
  border-top: 1px solid #e5e7eb;
}

/* Responsivo: no telemóvel, 1 coluna */
@media (max-width: 640px) {
  #obj-edit-modal .form-grid {
    grid-template-columns: 1fr;
  }
}


/* =========================
   Categorias Agrupadas (Accordion)
   ========================= */
/* Item Pai */
.cat-group-parent {
  cursor: pointer;
}

.cat-group-parent:hover {
  background: #f8fafc;
}

.cat-chevron {
  width: 20px;
  height: 20px;
  color: #94a3b8;
  transition: transform 0.2s ease;
}

.cat-chevron.is-open {
  transform: rotate(180deg);
}

/* Lista de Filhos (escondida por defeito) */
.cat-group-children {
  display: flex;
  flex-direction: column;
  gap: 8px;
  /* menos gap que o pai */
  padding-left: 20px;
  /* indentação */
  margin-top: -6px;
  /* cola ao pai */
  margin-bottom: 12px;
  overflow: hidden;
  border-left: 2px solid #e2e8f0;
  margin-left: 26px;
  /* alinha com o texto do pai */
}

.cat-group-children[hidden] {
  display: none;
}

/* Item filho mais compacto */
.cat-child-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 12px;
  background: #fff;
  border: 1px solid #f1f5f9;
  border-radius: 8px;
  font-size: 0.9em;
}

.cat-child-item:hover {
  border-color: #e2e8f0;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.02);
}

/* ===== Bulk Fixed Expenses Modal ===== */
.bulk-list {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.bulk-group {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 8px;
  overflow: hidden;
}

.bulk-group-header {
  padding: 10px 12px;
  background: var(--footer-grad);
  /* Matching App Header */
  color: #fff;
  border-bottom: 1px solid var(--border);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.bulk-group-title {
  display: flex;
  align-items: center;
  gap: 8px;
  font-weight: 600;
  color: #fff;
  /* Ensure contrast */
  font-size: 0.95em;
}

.bulk-group-total {
  font-size: 0.85em;
  font-weight: 500;
  color: rgba(255, 255, 255, 0.9);
  /* Softer white */
}

.bulk-group-body {
  padding: 0;
}

.bulk-item {
  display: flex;
  align-items: center;
  /* Center vertically */
  gap: 10px;
  padding: 10px 12px;
  border-bottom: 1px solid var(--border-subtle, #eee);
  transition: background 0.15s;
}

.bulk-item:last-child {
  border-bottom: none;
}

.bulk-item:hover {
  background: var(--bg-hover, #f1f5f9);
}

.bulk-item-check {
  display: flex;
  align-items: center;
}

.bulk-item-info {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 2px;
  min-width: 0;
  /* Text truncation support */
}

.bulk-item-desc {
  font-weight: 600;
  font-size: 0.95em;
  color: var(--text-main);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.bulk-item-sub {
  font-size: 0.8em;
  color: var(--text-sec);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.bulk-item-value input {
  width: 90px;
  text-align: right;
  padding: 6px;
  border: 1px solid var(--border);
  border-radius: 6px;
  background: var(--bg-input, #fff);
  font-weight: 500;
  color: var(--text-main);
}

.bulk-item-value input:focus {
  border-color: var(--primary);
  outline: none;
}

/* Extended FAB (Mobile Friendly) */
.fab-extended {
  position: fixed;
  bottom: calc(var(--footer-h, 60px) + 80px) !important;
  right: 16px !important;
  z-index: 1100;
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 18px;
  border-radius: 99px;
  background: var(--ui-fab-bg) !important; /* Follows theme! */
  color: #fff !important;
  border: none;
  font-size: 14px;
  font-weight: 600;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
  transition: transform 0.2s;
  width: max-content !important;
}

.fab-extended:active {
  transform: scale(0.96);
}

.fab-extended svg {
  fill: currentColor;
}

/* Ensure hidden works with flex */
.fab-extended.hidden {
  display: none !important;
}


/* === FIX: Theme Modal TEXT IS ALWAYS BLACK === */
#theme-overlay .rep-modal,
#theme-overlay .modal__card {
  background-color: #ffffff !important;
  color: #000000 !important;
  --text: #000000 !important;
  --muted: #444444 !important;
}

#theme-overlay *,
#theme-overlay h2,
#theme-overlay h3,
#theme-overlay label,
#theme-overlay span,
#theme-overlay div,
#theme-overlay p,
#theme-overlay .row-note,
#theme-overlay .badge-muted,
#theme-overlay button {
  color: #000000 !important;
}

#theme-overlay input,
#theme-overlay select {
  color: #000000 !important;
  background-color: #ffffff !important;
  border: 1px solid #cbd5e1 !important;
}

#theme-overlay .btn--primary {
  background-color: #0f172a !important;
  /* Keep primary button distinct but readable */
  color: #ffffff !important;
}

/* ================= ACESSIBILIDADE & UX ================= */

/* Skip Link */
.skip-link {
  position: absolute;
  top: -40px;
  left: 0;
  background: var(--brand);
  color: white;
  padding: 8px;
  z-index: 9999;
  transition: top 0.2s;
  font-weight: 600;
  text-decoration: none;
  border-radius: 0 0 8px 8px;
}

.skip-link:focus {
  top: 0;
}

/* Focus Rings */
:focus-visible {
  outline: 2px solid var(--brand);
  outline-offset: 2px;
}

.btn:focus-visible {
  outline-offset: -2px;
}

/* Reduced Motion */
@media (prefers-reduced-motion: reduce) {

  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* Skeleton Loading */
.skeleton {
  background-color: var(--surface-2);
  background-image: linear-gradient(90deg,
      var(--surface-2),
      var(--surface-3),
      var(--surface-2));
  background-size: 200px 100%;
  border-radius: 4px;
  display: inline-block;
  animation: bg-pulse 1.5s infinite linear;
}

@keyframes bg-pulse {
  0% {
    background-position: -200px 0;
  }

  100% {
    background-position: calc(200px + 100%) 0;
  }
}

.skeleton-text {
  height: 1em;
  width: 100%;
  margin-bottom: 0.5em;
}

.skeleton-circle {
  width: 40px;
  height: 40px;
  border-radius: 50%;
}

.skeleton-card {
  height: 120px;
  border-radius: 12px;
  width: 100%;
}

/* Onboarding Wizard */
.onboarding-wizard {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.6);
  z-index: 10000;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
  opacity: 1;
  transition: opacity 0.3s;
}

.onboarding-wizard.out {
  opacity: 0;
  pointer-events: none;
}

.onboarding-card {
  background: #ffffff !important;
  color: #1e293b !important;
  border-radius: 20px;
  padding: 30px;
  max-width: 400px;
  width: 100%;
  text-align: center;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
  animation: slide-up 0.4s cubic-bezier(0.16, 1, 0.3, 1);
}

@keyframes slide-up {
  from {
    transform: translateY(20px);
    opacity: 0;
  }

  to {
    transform: translateY(0);
    opacity: 1;
  }
}

.onboarding-img {
  font-size: 4rem;
  margin-bottom: 10px;
}

.onboarding-steps {
  text-align: left;
  list-style: none;
  padding: 0;
  margin: 20px 0;
  color: var(--text-sec);
}

.onboarding-steps li {
  margin-bottom: 10px;
  padding-left: 10px;
  border-left: 3px solid var(--brand);
}

.onboarding-actions {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

/* Toast System */
.toast-container {
  position: fixed;
  bottom: 80px;
  /* Above Bottom Nav/FAB */
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  flex-direction: column;
  gap: 8px;
  z-index: 11000;
  pointer-events: none;
  /* Let clicks pass through gaps */
  width: 90%;
  max-width: 400px;
}

.toast {
  pointer-events: auto;
  background: #ffffff !important;
  color: #1e293b !important;
  padding: 12px 16px;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  animation: toast-in 0.3s cubic-bezier(0.16, 1, 0.3, 1);
  border-left: 4px solid transparent;
}

@keyframes toast-in {
  from {
    transform: translateY(20px) scale(0.9);
    opacity: 0;
  }

  to {
    transform: translateY(0) scale(1);
    opacity: 1;
  }
}

.toast--out {
  animation: toast-out 0.3s forwards;
}

@keyframes toast-out {
  to {
    opacity: 0;
    transform: translateY(-10px);
  }
}

.toast--success {
  border-left-color: #22c55e;
}

.toast--error {
  border-left-color: #ef4444;
}

.toast--info {
  border-left-color: #3b82f6;
}

.toast__close {
  background: none;
  border: none;
  color: var(--text-sec);
  font-size: 1.2rem;
  cursor: pointer;
  padding: 0 4px;
}

/* Modal System (Native Dialog Replacement) */
.wb-modal-dialog {
  padding: 0;
  border: none;
  border-radius: 16px;
  box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
  background: var(--surface, #ffffff);
  max-width: 90%;
  width: 400px;
}

.wb-modal-dialog::backdrop {
  background: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(2px);
}

.wb-modal-content {
  padding: 20px;
}

.wb-modal-title {
  margin: 0 0 10px 0;
}

.wb-modal-msg {
  color: var(--text-sec);
  margin-bottom: 20px;
  line-height: 1.5;
}

.wb-modal-actions {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
}

/* Tooltip for FAB */
/* .fab-item: positioning removed to fix layout */
.fab-item:hover::after {
  content: attr(aria-label);
  position: absolute;
  right: 60px;
  background: rgba(0, 0, 0, 0.8);
  color: white;
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 0.8rem;
  white-space: nowrap;
  pointer-events: none;
}


/* FORCE SPLASH VISIBILITY FIX */
.wb-splash {
  position: fixed;
  inset: 0;
  z-index: 99999;
  background: var(--bg);
  display: flex;
  align-items: center;
  justify-content: center;
  transition: opacity 0.5s, visibility 0.5s;
}

.wb-splash.is-hiding {
  opacity: 0;
  visibility: hidden;
  pointer-events: none;
}


/* ================= ELECTRIC SPLASH THEME ================= */
:root {
  --elec-primary: #0de3f2;
  --elec-secondary: #10b981;
  --elec-bg: #0b1220;
}

#wb-splash.electric-mode {
  background-color: var(--elec-bg);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  color: white;
  font-family: 'Outfit', sans-serif;
  overflow: hidden;
}

/* Background Effects */
.elec-bg-glow {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 500px;
  height: 500px;
  background: rgba(13, 227, 242, 0.05);
  border-radius: 50%;
  filter: blur(100px);
  animation: elec-pulse 1.5s infinite;
}

/* Glass Card & Neon Box */
.elec-glass-card {
  width: 14rem;
  height: 14rem;
  background: rgba(16, 33, 34, 0.4);
  backdrop-filter: blur(12px);
  border: 1px solid rgba(255, 255, 255, 0.05);
  border-radius: 2rem;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  overflow: hidden;
  box-shadow: 0 0 10px rgba(13, 227, 242, 0.2);
  border: 1px solid rgba(13, 227, 242, 0.3);
  margin-bottom: 3rem;
}

/* Logo Bars Construction */
.elec-house {
  position: relative;
  width: 10rem;
  height: 10rem;
  display: flex;
  align-items: flex-end;
  justify-content: space-between;
  gap: 2px;
  clip-path: polygon(50% 0%, 100% 35%, 100% 100%, 0% 100%, 0% 35%);
}

.elec-bar-slot {
  position: relative;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: flex-end;
  justify-content: center;
}

.elec-guide-line {
  position: absolute;
  inset: 0;
  width: 1px;
  background: rgba(255, 255, 255, 0.3);
  margin: 0 auto;
}

.elec-bar {
  width: 85%;
  animation: elec-pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

.elec-bar.primary {
  background: var(--elec-primary);
  box-shadow: 0 0 8px var(--elec-primary);
}

.elec-bar.secondary {
  background: var(--elec-secondary);
  box-shadow: 0 0 8px var(--elec-secondary);
}

.elec-bar.gradient {
  background: linear-gradient(to top, var(--elec-primary), var(--elec-secondary));
}

@keyframes elec-pulse {

  0%,
  100% {
    opacity: 1;
  }

  50% {
    opacity: .5;
  }
}

/* Typography */
.elec-title {
  font-size: 3.5rem;
  font-weight: 800;
  letter-spacing: -0.05em;
  margin: 0;
  line-height: 1;
  text-align: center;
  animation: elec-flicker 3s infinite;
}

.elec-title span {
  color: white;
}

.elec-title .highlight {
  background: linear-gradient(135deg, #fff 0%, #0de3f2 50%, #10b981 100%);
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
  filter: drop-shadow(0 0 15px rgba(13, 227, 242, 0.3));
}

.elec-subtitle {
  color: rgba(13, 227, 242, 0.6);
  font-size: 0.875rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.3em;
  margin-top: 0.5rem;
}

@keyframes elec-flicker {

  0%,
  19.9%,
  22%,
  62.9%,
  64%,
  64.9%,
  70%,
  100% {
    opacity: 1;
  }

  20%,
  21.9%,
  63%,
  63.9%,
  65%,
  69.9% {
    opacity: 0.4;
  }
}

/* Loading Bar */
.elec-loader-box {
  width: 250px;
  margin-top: 2rem;
}

.elec-track {
  height: 2px;
  width: 100%;
  background: rgba(255, 255, 255, 0.1);
  position: relative;
  overflow: hidden;
}

.elec-progress {
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  background: linear-gradient(to right, var(--elec-primary), var(--elec-secondary));
  box-shadow: 0 0 15px var(--elec-primary);
  width: 0%;
  transition: width 0.1s linear;
}

.elec-status {
  display: flex;
  justify-content: space-between;
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.15em;
  color: rgba(13, 227, 242, 0.8);
  margin-top: 8px;
}


/* =========================
   Guide / Help Presentation
   ========================= */
.guide-btn {
  margin-left: auto;
  background: rgba(255, 255, 255, .15);
  border: none;
  color: #fff;
  width: 32px;
  height: 32px;
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background .15s;
}

.guide-btn:hover {
  background: rgba(255, 255, 255, .25);
}

.guide-modal {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, .5);
  backdrop-filter: blur(4px);
  display: grid;
  place-items: center;
  z-index: 9999;
}

.guide-modal.hidden {
  display: none;
}

.guide-card {
  background: #fff;
  width: min(600px, 92vw);
  max-height: 85vh;
  border-radius: 18px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, .25);
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.guide-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 20px;
  border-bottom: 1px solid #e5e7eb;
}

.guide-content {
  padding: 18px 22px;
  overflow-y: auto;
}

.guide-content section {
  margin-bottom: 24px;
}

.guide-content h3 {
  margin-top: 0;
  margin-bottom: 8px;
  color: #111827;
  font-weight: 700;
  font-size: 1.1em;
}

.guide-content p {
  margin: 0 0 10px 0;
  color: #4b5563;
  line-height: 1.4;
}

.guide-content ul {
  padding-left: 20px;
  margin: 0;
  color: #374151;
}

.guide-content li {
  margin-bottom: 6px;
  line-height: 1.4;
}

.guide-content strong {
  color: #0f172a;
}

.guide-sect-icon {
  width: 24px;
  height: 24px;
  vertical-align: text-bottom;
  margin-right: 8px;
  color: #0d9488;
  /* Teal-600 */
}


/* =========================
   Advanced Guide System
   ========================= */

/* Header Global Button */
.guide-btn {
  background: rgba(255, 255, 255, 0.1);
  color: #fff;
  width: 36px;
  height: 36px;
  border-radius: 50%;
  border: 1px solid rgba(255, 255, 255, 0.2);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
  margin-left: 8px;
}

.guide-btn:hover {
  background: rgba(255, 255, 255, 0.25);
  transform: scale(1.05);
}

.guide-btn .guide-icon {
  width: 20px;
  height: 20px;
}

/* Contextual Screen Button */
.screen-help-btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 4px 10px;
  font-size: 12px;
  font-weight: 600;
  color: var(--muted);
  background: rgba(0, 0, 0, 0.03);
  border: 1px solid var(--border);
  border-radius: 20px;
  cursor: pointer;
  margin-left: auto;
  /* Push to right if in flex container */
  transition: all 0.2s;
}

.screen-help-btn:hover {
  background: var(--surface);
  color: var(--primary);
  border-color: var(--primary);
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
}

.screen-help-btn span {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 16px;
  height: 16px;
  background: var(--muted);
  color: #fff;
  border-radius: 50%;
  font-size: 10px;
  font-weight: bold;
}

.screen-help-btn:hover span {
  background: var(--primary);
}

/* Modal Styling */
.guide-modal {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.6);
  backdrop-filter: blur(5px);
  -webkit-backdrop-filter: blur(5px);
  display: grid;
  place-items: center;
  z-index: 10000;
  padding: 16px;
}

.guide-modal.hidden {
  display: none;
}

.guide-card {
  background: #fff;
  width: 100%;
  max-width: 600px;
  max-height: 85vh;
  border-radius: 18px;
  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
  display: flex;
  flex-direction: column;
  overflow: hidden;
  animation: modalPop 0.3s cubic-bezier(0.16, 1, 0.3, 1);
}

@keyframes modalPop {
  from {
    opacity: 0;
    transform: scale(0.95) translateY(10px);
  }

  to {
    opacity: 1;
    transform: scale(1) translateY(0);
  }
}

.guide-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 20px;
  border-bottom: 1px solid #f1f5f9;
  background: #fff;
}

.guide-header h2 {
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 1.25rem;
  font-weight: 700;
  color: #0f172a;
  margin: 0;
}

.guide-header .guide-icon {
  width: 24px;
  height: 24px;
  color: var(--primary, #0ea5e9);
}

.icon-btn {
  background: transparent;
  border: none;
  font-size: 20px;
  color: #64748b;
  cursor: pointer;
  padding: 4px;
  border-radius: 50%;
  display: grid;
  place-items: center;
  width: 32px;
  height: 32px;
}

.icon-btn:hover {
  background: #f1f5f9;
  color: #0f172a;
}

.guide-content {
  padding: 0;
  overflow-y: auto;
  scroll-behavior: smooth;
  background: #f8fafc;
}

/* Section Styling */
.guide-section {
  background: #fff;
  margin: 16px;
  padding: 20px;
  border-radius: 12px;
  border: 1px solid #e2e8f0;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.03);
  transition: transform 0.3s, border-color 0.3s;
}

/* Highlight Contextual Section */
.guide-section.highlight {
  border-color: var(--primary, #0ea5e9);
  box-shadow: 0 0 0 2px rgba(14, 165, 233, 0.15);
}

.guide-sec-header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 16px;
  padding-bottom: 12px;
  border-bottom: 1px solid #f1f5f9;
}

.guide-sec-icon {
  color: var(--primary, #0ea5e9);
  width: 24px;
  height: 24px;
}

.guide-sec-header h3 {
  font-size: 1.1rem;
  font-weight: 700;
  color: #1e293b;
  margin: 0;
}

.guide-block {
  margin-bottom: 16px;
}

.guide-block h4 {
  font-size: 0.85rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: #64748b;
  margin-bottom: 8px;
  font-weight: 700;
}

.guide-block ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.guide-block li {
  position: relative;
  padding-left: 18px;
  margin-bottom: 6px;
  font-size: 0.95rem;
  color: #334155;
  line-height: 1.5;
}

.guide-block li::before {
  content: '';
  position: absolute;
  left: 4px;
  color: #cbd5e1;
  font-weight: bold;
}

.guide-tips {
  background: #eff6ff;
  border-left: 4px solid #3b82f6;
  padding: 12px 16px;
  border-radius: 0 8px 8px 0;
  font-size: 0.9rem;
}

.guide-tips strong {
  display: block;
  margin-bottom: 4px;
  color: #1e3a8a;
}

.guide-tips ul {
  padding-left: 16px;
  margin: 0;
  color: #1e40af;
}

/* Dark Mode Overrides (if applicable) */
.dark-mode .guide-card {
  background: #1e293b;
  color: #f8fafc;
}

.dark-mode .guide-header,
.dark-mode .guide-section {
  background: #1e293b;
  border-color: #334155;
}

.dark-mode .guide-header h2,
.dark-mode .guide-sec-header h3 {
  color: #f1f5f9;
}

.dark-mode .guide-content {
  background: #0f172a;
}

.dark-mode .guide-block li {
  color: #cbd5e1;
}

/* =========================
   Categories Modal Overlay (Requested Fix)
   ========================= */
.rpt-overlay {
  position: fixed;
  inset: 0;
  z-index: 9999;
  background-color: rgba(0, 0, 0, 0.65);
  backdrop-filter: blur(6px);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 16px;
  opacity: 1;
  transition: opacity 0.2s ease-in-out;
}

.rpt-overlay.hidden {
  display: none !important;
  opacity: 0;
  pointer-events: none;
}

.rpt-modal {
  background: var(--ui-card-bg);
  border: 1px solid var(--ui-card-border);
  border-radius: 20px;
  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
  width: 100%;
  max-width: 420px;
  max-height: 90vh;
  overflow-y: auto;
  position: relative;
  /* Ensure it has a high z-index */
  z-index: 10000;
  /* Animation for nice enter */
  animation: modal-enter 0.3s cubic-bezier(0.16, 1, 0.3, 1);
}

@keyframes modal-enter {
  from {
    opacity: 0;
    transform: scale(0.95) translateY(10px);
  }

  to {
    opacity: 1;
    transform: scale(1) translateY(0);
  }
}

/* === FIX: CONTRAST OVERRIDES === */
/* Auth Modal: Force dark text always */
.auth-card {
  color: #1e293b !important;
}

/* Mini Cards: Adapt to theme variables */
.mini-card {
  color: var(--text) !important;
  background: #ffffff !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}

.mini-card__title {
  color: var(--text) !important;
}

.mini-card__hint {
  color: var(--muted) !important;
}

/* KPI Labels override: Force dark gray (on white cards) */
.kpi__title {
  color: #64748b !important;
}

/* === FIX: Bulk Expenses Modal (Nova) === */
/* Force black text for the note and list items */
#fixed-bulk-modal .row-note {
  color: #1e293b !important;
}

.bulk-item-desc,
.bulk-item-sub {
  color: #1e293b !important;
}

/* The group title in bulk list is usually white on dark header, 
   but if user wants "etiquetas" black, they might mean the items. 
   I will leave group title as is (it has contrast) but ensure items are black. */

/* === FIX: Upcoming Expenses (Dashboard) === */
.upcoming-card {
  color: #1e293b !important;
}

.uc-cat,
.uc-amount {
  color: #1e293b !important;
}

/* Dates "color of warning" (Assuming Amber/Orange) */
.uc-date {
  color: #f59e0b !important;
  /* Amber-500 */
}

.uc-day,
.uc-month {
  color: inherit !important;
}

/* === FIX: Forecast 2026 Modal (Extra Chart Panel) === */
/* Force black text on all explanatory paragraphs and labels */
#chart-cashflow-fixed-extra .muted,
#chart-cashflow-fixed-extra .muted strong,
#chart-cashflow-fixed-extra .muted span {
  color: #1e293b !important;
}

/* Toggle button text */
#fx26-toggle {
  color: #1e293b !important;
}

/* Panel labels and inputs */
#fx26-panel label,
#fx26-panel span {
  color: #1e293b !important;
}

#fx26-panel input[type="checkbox"]+span {
  color: #1e293b !important;
}

.auth-card input,
.modal__card input {
  color: #1e293b !important;
  background-color: #ffffff !important;
  border-color: #cbd5e1 !important;
}

.auth-card label {
  color: #1e293b !important;
}

/* Specific fix for Nova Transaction Type buttons inside cards */
.card label.btn {
  color: #1e293b !important;
  background-color: #f1f5f9;
  border: 1px solid #cbd5e1;
}

.card label.btn:has(input:checked) {
  background-color: #e2e8f0;
  border-color: #94a3b8;
}

/* === AI ASSISTANT STYLES === */
.ai-panel {
  background: #ffffff !important;
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 12px;
  margin-bottom: 16px;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  display: flex;
  flex-direction: column;
  gap: 10px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  animation: slideDown 0.3s ease-out;
}

@keyframes slideDown {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}

.ai-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  font-weight: 700;
  font-size: 0.9em;
  color: var(--primary);
}

.ai-controls {
  display: flex;
  gap: 10px;
  align-items: center;
}

.ai-input-wrapper {
  flex: 1;
  position: relative;
}

.ai-input {
  width: 100%;
  padding: 10px 12px;
  border: 1px solid var(--border);
  border-radius: 8px;
  background: rgba(255,255,255,0.05);
  color: var(--text);
  font-size: 0.95em;
}

.ai-mic-btn {
  width: 44px;
  height: 44px;
  border-radius: 50%;
  border: none;
  background: var(--primary);
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.2s;
  flex-shrink: 0;
}

.ai-mic-btn:active {
  transform: scale(0.9);
}

.ai-mic-btn.ai-listening {
  background: #ef4444;
  animation: pulseMic 1.5s infinite;
}

@keyframes pulseMic {
  0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
  70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
  100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
}

.ai-status {
  font-size: 0.8em;
  color: var(--muted);
  min-height: 1.2em;
}

.ai-feedback {
  padding: 6px 10px;
  border-radius: 6px;
  background: rgba(34, 197, 94, 0.1);
  color: #22c55e;
  font-size: 0.85em;
  border: 1px solid rgba(34, 197, 94, 0.2);
  margin-top: 4px;
}
/* ===== White Analytical Cards: Independent of theme ===== */
:root {
  --mini-card-bg: #ffffff;
  --mini-card-text: #0f172a;
  --mini-card-muted: #64748b;
  
  --white-card-bg: #ffffff;
  --white-card-text: #1e293b;
  --white-card-muted: #64748b;
}

/* 1. KPIs (Resumo do mês) */
.kpi-section, 
section.card:has(#kpi-income),
section.card:has(.kpi) {
  background: var(--white-card-bg) !important;
  color: var(--white-card-text) !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}

/* 2. Próximas despesas */
section.card:has(#upcoming-fixed-list) {
  background: var(--white-card-bg) !important;
  color: var(--white-card-text) !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}

/* 3. Análises rápidas (The section containing mini-cards) */
section.card:has(.mini-carousel) {
  background: var(--white-card-bg) !important;
  color: var(--white-card-text) !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}

/* 4. Mini-cards themselves (HARD FIX as requested) */
.mini-card {
  background: var(--mini-card-bg) !important;
  color: var(--mini-card-text) !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  border: 1px solid #e2e8f0 !important;
}
.mini-card__title { color: var(--mini-card-text) !important; }
.mini-card__hint { color: var(--mini-card-muted) !important; }

/* 5. Detailed Breakdown / Charts */
section.card:has(#cat-list) {
  background: var(--white-card-bg) !important;
  color: var(--white-card-text) !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}

/* Override KPI titles specifically inside these white cards */
.kpi-section .kpi__title,
section.card:has(#kpi-income) .kpi__title,
section.card:has(.kpi) .kpi__title {
  color: var(--white-card-muted) !important;
}

/* Version Tag Styles */
.version-tag {
  font-size: 10px;
  color: var(--muted);
  opacity: 0.8;
  padding: 10px;
  text-align: center;
  font-family: monospace;
  width: 100%;
}

/* ============================================================
   WB THEME HARDENING - FINAL (SAFE)
   - NÃO sobrescreve --text/--muted (vem do theme.js)
   - Cards/sections respeitam transparência do tema
   - Mini-cards ficam SEMPRE brancos com texto escuro
   - FAB/Header/Footer seguem variáveis persistentes
   ============================================================ */

:root{
  /* Aliases para compatibilidade com variáveis antigas no projeto */
  --card-bg: var(--ui-card-bg);
  --card-border: var(--ui-card-border);
  --card-blur: var(--ui-card-blur);
  --primary: var(--ui-fab-bg);
}

/* SECTION CARDS: respeitam o tema (transparência/blur) */
.card{
  background: var(--ui-card-bg);
  border-color: var(--ui-card-border);
  backdrop-filter: blur(var(--ui-card-blur));
  -webkit-backdrop-filter: blur(var(--ui-card-blur));
}

/* TÍTULOS/UX TEXT: seguem o tema (o utilizador pode mudar a cor) */
.section-title,
label,
.muted,
.badge-muted,
.row-note{
  color: var(--text);
}

/* MINI-CARDS: SEMPRE brancos e legíveis (independente do tema) */
.mini-card,
.upcoming-card{
  background: #ffffff !important;
  color: #0f172a !important;
  border-color: #e2e8f0 !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}

/* Texto interno dos mini-cards (não depende de --text) */
.mini-card__title,
.mini-card__hint,
.upcoming-card .uc-cat,
.upcoming-card .uc-amount,
.upcoming-card .uc-day,
.upcoming-card .uc-month{
  color: #0f172a !important;
}

/* Componentes estruturais: seguem variáveis persistentes */
.app-header{ background: var(--ui-header-bg); }
.app-footer{ background: var(--ui-menu-bg); }

/* FABs: seguem a cor persistida do tema */
.fab-nav__toggle,
.fab-item,
.fab-extended,
.fab-menu-title{
  background: var(--ui-fab-bg) !important;
  color: #ffffff !important;
}

/* === Collapsible Cards === */
.card.is-collapsed .card__content {
  grid-template-rows: 0fr;
  padding-bottom: 0;
  padding-top: 0;
  opacity: 0;
}
