<section class="card">
  <h2 class="section-title">Importar CSV</h2>

  <div id="csv-import" class="grid" style="grid-template-columns:1fr;gap:10px">
    <label>Ficheiro CSV
      <input id="imp-file" type="file" accept=".csv,text/csv" />
    </label>

    <div style="display:flex;gap:10px;flex-wrap:wrap">
      <button id="imp-parse"  class="btn btn--primary">Pré-visualizar</button>
      <button id="imp-import" class="btn" disabled>Importar</button>
    </div>

    <progress id="imp-progress" value="0" max="100" hidden style="width:220px"></progress>
    <pre id="imp-info" style="margin:0;color:#0f172a;opacity:.9"></pre>
    <pre id="imp-log"  style="margin:0;color:#475569;max-height:180px;overflow:auto;background:#f8fafc;border:1px solid #e2e8f0;padding:8px;border-radius:8px"></pre>

    <div id="imp-preview" style="border:1px solid #e5e7eb;border-radius:12px;padding:10px;overflow:auto"></div>
  </div>
</section>

<section class="card">
  <h2 class="section-title">Relatórios</h2>
  <p class="muted">Gera um relatório mensal ou anual com KPIs, distribuição de categorias, fixas vs variáveis, taxas de esforço e séries mensais.</p>
  <button id="btn-report-open" class="btn btn--primary">Abrir relatório</button>
</section>

<!-- ============ MODAL DO RELATÓRIO ============ -->
<div id="report-backdrop" class="modal-backdrop hidden"></div>
<div id="report-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="report-title">
  <header class="modal__header">
    <h3 id="report-title">Relatório Financeiro</h3>
    <button id="report-close" class="icon-btn" aria-label="Fechar">✕</button>
  </header>

  <div class="modal__body">
    <!-- Controlos (apenas para escolher período; os títulos/fixos são definidos no JS) -->
    <div class="controls">
      <label class="control">
        <span>Âmbito</span>
        <div class="seg">
          <label><input type="radio" name="rep-scope" value="monthly" checked> Mensal</label>
          <label><input type="radio" name="rep-scope" value="annual"> Anual</label>
        </div>
      </label>

      <label id="ctl-month" class="control">
        <span>Mês</span>
        <input type="month" id="rep-month">
      </label>

      <label class="control">
        <span>Ano</span>
        <select id="rep-year"></select>
      </label>

      <button id="btn-report-preview" class="btn">Pré-visualizar</button>
    </div>

    <!-- Pré-visualização (HTML) -->
    <div id="report-preview" class="report">
      <!-- preenchido pelo settings.js -->
    </div>
  </div>

  <footer class="modal__footer">
    <button id="btn-report-pdf" class="btn btn--primary">Gerar PDF</button>
  </footer>
</div>

<!-- ====== estilos mínimos do modal/preview ====== -->
<style>
  .modal-backdrop{position:fixed;inset:0;background:rgba(15,23,42,.6);backdrop-filter:saturate(1.2) blur(2px);z-index:40}
  .modal{position:fixed;inset:auto 0 0 0;margin:auto;max-width:980px;width:95%;background:#ffffff;color:#0f172a;border:1px solid #e5e7eb;border-radius:16px;box-shadow:0 20px 50px rgba(2,6,23,.25);z-index:50;
         display:flex;flex-direction:column;max-height:90vh}
  .modal.hidden,.modal-backdrop.hidden{display:none}
  .modal__header{padding:14px 16px;border-bottom:1px solid #e5e7eb;display:flex;align-items:center;justify-content:space-between}
  .modal__body{padding:14px 16px;overflow:auto}
  .modal__footer{padding:12px 16px;border-top:1px solid #e5e7eb;display:flex;justify-content:flex-end;gap:10px}
  .icon-btn{background:#f1f5f9;border:1px solid #e2e8f0;border-radius:8px;padding:4px 8px}
  .controls{display:grid;grid-template-columns:1fr 1fr 1fr auto;gap:12px;align-items:end;margin-bottom:12px}
  .controls .control{display:flex;flex-direction:column;gap:6px}
  .seg{display:flex;gap:10px;background:#f8fafc;border:1px solid #e2e8f0;padding:6px 8px;border-radius:8px}
  .report{display:grid;gap:14px}
  .r-card{border:1px solid #e5e7eb;border-radius:12px;padding:12px;background:#fff}
  .r-title{font-weight:700;margin:0 0 8px 0}
  .kpi-grid{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:10px}
  .kpi{border:1px dashed #e5e7eb;border-radius:10px;padding:10px}
  .kpi .k{font-size:.8rem;color:#475569}
  .kpi .v{font-size:1.1rem;font-weight:700;margin-top:4px}
  .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  @media (max-width:820px){.controls{grid-template-columns:1fr 1fr}.grid-2{grid-template-columns:1fr}.kpi-grid{grid-template-columns:repeat(2,minmax(0,1fr))}}
  .table{width:100%;border-collapse:collapse;font-size:.92rem}
  .table th,.table td{border-bottom:1px solid #eef2f7;padding:6px 8px;text-align:left}
  .muted{color:#64748b}
  canvas{display:block;width:100%;height:280px}
</style>
