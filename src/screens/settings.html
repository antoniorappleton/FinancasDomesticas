<section class="card">
  <h2 class="section-title">Importação CSV</h2>

  <div class="form-grid">
    <label>
      Ficheiro CSV
      <input id="imp-file" type="file" accept=".csv,text/csv" />
    </label>
    <label>
      Mês (para registo)
      <input id="imp-month" type="month" />
    </label>
  </div>

  <div class="actions" style="margin-top:8px">
    <button id="imp-preview" class="btn">Pré-visualizar</button>
    <button id="imp-import"  class="btn btn--primary">Importar</button>
    <button id="imp-clear"   class="btn">Limpar pré-visualização</button>
  </div>

  <p id="imp-info" class="row-note"></p>
  <pre id="imp-log" class="row-note" style="white-space:pre-wrap"></pre>

  <div id="imp-table-wrap" class="card soft" style="margin-top:12px; display:none">
    <h3 class="section-title">Pré-visualização</h3>
    <div style="overflow:auto">
      <table id="imp-table">
        <thead></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</section>

<section class="card">
  <h2 class="section-title">Relatórios</h2>

  <div class="grid" style="grid-template-columns: repeat(4, minmax(0,1fr)); gap:10px">
    <label>
      Tipo
      <select id="rpt-type">
        <option value="monthly" selected>Mensal</option>
        <option value="range">Intervalo de meses</option>
        <option value="yearly">Anual</option>
      </select>
    </label>

    <label id="rpt-month-wrap">
      Mês
      <input id="rpt-month" type="month" />
    </label>

    <label id="rpt-range-wrap" class="hidden">
      De (YYYY-MM)
      <input id="rpt-from" type="month" />
    </label>

    <label id="rpt-range2-wrap" class="hidden">
      Até (YYYY-MM)
      <input id="rpt-to" type="month" />
    </label>

    <label id="rpt-year-wrap" class="hidden">
      Ano
      <input id="rpt-year" type="number" min="2000" max="2100" step="1" />
    </label>
  </div>

  <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:10px">
    <button id="btn-report-open" class="btn btn--primary">Abrir relatório…</button>
  </div>
</section>

<!-- ===== MODAL RELATÓRIO ===== -->
<div id="report-overlay" class="hidden rpt-overlay" aria-hidden="true" tabindex="-1">
  <div class="rpt-modal">
    <button id="rpt-close" class="rpt-close" aria-label="Fechar">×</button>
    <h2 id="rpt-title">Relatório Financeiro</h2>

    <div class="rpt-kpis">
      <div><div>Receitas</div><strong id="rpt-kpi-income">€ 0,00</strong></div>
      <div><div>Despesas</div><strong id="rpt-kpi-expense">€ 0,00</strong></div>
      <div><div>Poupanças</div><strong id="rpt-kpi-savings">€ 0,00</strong></div>
      <div><div>Saldo</div><strong id="rpt-kpi-balance">€ 0,00</strong></div>
    </div>

    <div class="rpt-grid">
      <div class="rpt-card">
        <canvas id="rpt-cat-pie" height="240"></canvas>
        <div id="rpt-cat-legend" class="rpt-legend"></div>
      </div>
      <div class="rpt-card">
        <canvas id="rpt-fixed-donut" height="240"></canvas>
      </div>
    </div>

    <div class="rpt-card">
      <canvas id="rpt-series" height="260"></canvas>
    </div>

    <ul id="rpt-insights" class="rpt-insights"></ul>

    <div class="rpt-actions">
      <button id="rpt-export" class="btn">Exportar PDF</button>
    </div>
  </div>
</div>

<style>
  .hidden{display:none}
  .rpt-overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);display:flex;align-items:flex-start;justify-content:center;overflow:auto;padding:24px;z-index:1000}
  .rpt-modal{background:#f2f4f9;color:#e5e7eb;width:min(1100px,92vw);border-radius:12px;padding:16px 20px 28px;position:relative;color:#1d1e1e}
  .rpt-close{position:absolute;top:8px;right:10px;font-size:22px;line-height:1;color:#1d1e1e}
  .rpt-kpis{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin:12px 0;color:#1d1e1e}
  .rpt-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:16px;color:#1d1e1e}
  .rpt-card{background:#f1f3f6;border:1px solid #e2e9f2;border-radius:12px;padding:12px;color:#1d1e1e}
  .rpt-legend__item{display:flex;align-items:center;gap:8px;padding:4px 0;color:#1d1e1e}
  .rpt-legend__dot{width:10px;height:10px;border-radius:50%;color:#1d1e1e}
  .btn{padding:8px 12px;border:1px solid #334155;border-radius:10px;background:#111827;color:#e5e7eb;}
</style>



<!-- ===== MANUTENÇÃO DE DADOS ===== -->
<section class="card">
  <h2 class="section-title">Manutenção de Dados</h2>
  <div class="actions">
    <button id="btn-del-month" class="btn btn--primary" style="background:#ef4444;border-color:#ef4444">Eliminar Mês Atual</button>
    <button id="btn-del-range" class="btn">Eliminar Período…</button>
    <button id="btn-del-all" class="btn">Eliminar Tudo…</button>

    <!-- NOVO -->
    <button id="btn-regularity-bulk" class="btn">Definir Regularidade (bulk)…</button>
  </div>
  <p class="row-note">Estas ações afetam apenas os seus dados (RLS ativo).</p>
</section>

<section class="card">
  <h2 class="section-title">Categorias</h2>
  <p>Cria, edita ou remove as tuas categorias e subcategorias.</p>
  <a href="#/categories" class="btn btn--primary">Gerir categorias</a>
</section>

<!-- Sessão -->
<section class="card" id="card-session" style="margin-top:12px">
  <h2 class="section-title">Sessão</h2>
  <div class="grid" style="grid-template-columns:2fr 1fr;gap:10px;align-items:end">
    <div>
      <div class="row-note">Autenticado como:</div>
      <div id="sess-user-email" style="font-weight:700">—</div>
    </div>
    <div style="text-align:right">
      <button id="btn-logout" class="btn">Terminar sessão</button>
    </div>
  </div>
</section>

<!-- Alterar palavra-passe -->
<section id="sec-password" class="card">
  <h3 class="section-title">Alterar palavra-passe</h3>
  <div class="grid" style="grid-template-columns:1fr;gap:10px">
    <label>Nova palavra-passe
      <input id="set-new-pass" type="password" autocomplete="new-password" />
    </label>
    <label>Confirmar nova palavra-passe
      <input id="set-new-pass-2" type="password" autocomplete="new-password" />
    </label>
  </div>
  <div style="display:flex;gap:10px;margin-top:12px">
    <button id="btn-change-pass" class="btn btn--primary">Atualizar</button>
  </div>
  <div id="set-msg" class="row-note" style="margin-top:8px"></div>
</section>


<script type="module" src="/src/main.js?v=v7"></script>
