<section class="card" id="csv-import">
  <h2 class="section-title">Importar CSV</h2>

  <div class="grid" style="grid-template-columns:1fr;gap:10px">
    <label>Ficheiro CSV
      <input id="imp-file" type="file" accept=".csv,text/csv" />
    </label>

    <div style="display:flex; gap:10px; flex-wrap:wrap">
      <button id="imp-parse"  class="btn">Pré-visualizar</button>
      <button id="imp-import" class="btn btn--primary" disabled>Importar</button>
    </div>

    <progress id="imp-progress" max="100" value="0" hidden style="width:100%"></progress>

    <div id="imp-info" class="card" style="display:block;white-space:pre-wrap"></div>
    <div id="imp-preview" class="card" style="overflow:auto"></div>
    <pre id="imp-log" class="card" style="max-height:220px;overflow:auto;background:#0b1020;color:#dbeafe"></pre>
  </div>
</section>
<!-- === RELATÓRIOS === -->
<section class="card" id="reports-card">
  <h2 class="section-title">Relatórios</h2>

  <div class="grid" style="grid-template-columns:1fr 1fr; gap:8px">
    <label>Âmbito
      <select id="rpt-scope">
        <option value="month" selected>Mensal</option>
        <option value="year">Anual</option>
      </select>
    </label>
    <label>Período
      <input id="rpt-month" type="month" />
    </label>
  </div>

  <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:8px">
    <button id="btn-report-open" class="btn btn--primary">Abrir relatório…</button>
  </div>
</section>
<!-- ===== MODAL RELATÓRIO ===== -->
<div id="report-overlay" class="rpt-overlay hidden" aria-hidden="true">
  <div class="rpt-modal" role="dialog" aria-modal="true" aria-labelledby="rpt-title">

    <header class="rpt-header">
      <h3 id="rpt-title">Relatório Financeiro</h3>
      <button id="rpt-close" class="icon-btn" aria-label="Fechar">✕</button>
    </header>

    <div class="rpt-body">
      <section class="grid rpt-kpis">
        <div class="kpi"><div class="kpi__label">Receitas</div><div id="rpt-kpi-income"  class="kpi__value">—</div></div>
        <div class="kpi"><div class="kpi__label">Despesas</div><div id="rpt-kpi-expense" class="kpi__value">—</div></div>
        <div class="kpi"><div class="kpi__label">Poupanças</div><div id="rpt-kpi-savings" class="kpi__value">—</div></div>
        <div class="kpi"><div class="kpi__label">Saldo</div><div id="rpt-kpi-balance" class="kpi__value">—</div></div>
      </section>

      <section class="card soft">
        <h4 class="section-title">Distribuição de despesas por categorias</h4>
        <div class="chart"><canvas id="rpt-cat-pie"></canvas></div>
      </section>

      <section class="card soft">
        <h4 class="section-title">Distribuição de despesas por categorias</h4>
        <div class="chart"><canvas id="rpt-cat-pie"></canvas></div>
        <div id="rpt-cat-legend" class="rpt-legend"></div> <!-- NOVO -->
      </section>


      <section class="card soft">
        <h4 class="section-title">Fixas vs Variáveis</h4>
        <div class="chart"><canvas id="rpt-fixed-donut"></canvas></div>
      </section>

      <section class="card soft">
        <h4 class="section-title">Séries mensais</h4>
        <div class="chart"><canvas id="rpt-series"></canvas></div>
      </section>
    </div>

    <footer class="rpt-footer">
      <button id="rpt-preview" class="btn">Pré-visualizar</button>
      <button id="rpt-pdf" class="btn btn--primary">Gerar PDF</button>


      <section class="card soft">
        <h4 class="section-title">Insights</h4>
        <ul id="rpt-insights" class="rpt-insights"></ul>
      </section>

      <section class="card soft">
        <h4 class="section-title">Tabela comparativa</h4>
        <div class="table-wrap">
          <table id="rpt-table" class="rpt-table"></table>
        </div>
      </section>



    </footer>
  </div>
</div>

<!-- estilos mínimos do modal (se ainda não tiveres) -->
<style>
  .rpt-overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(2,6,23,.6);padding:12px;z-index:1000}
  .rpt-overlay.hidden{display:none}
  .rpt-modal{width:min(100%,880px);max-height:92vh;background:#fff;color:#0f172a;border-radius:16px;overflow:hidden;box-shadow:0 12px 40px rgba(2,6,23,.35)}
  .rpt-header,.rpt-footer{background:#f8fafc;border-bottom:1px solid #e5e7eb;padding:12px 14px;display:flex;align-items:center;gap:8px}
  .rpt-header{position:sticky;top:0;z-index:5;justify-content:space-between}
  .rpt-footer{position:sticky;bottom:0;border-top:1px solid #e5e7eb;border-bottom:none;justify-content:flex-end;gap:8px}
  .rpt-body{padding:12px 14px;overflow:auto;max-height:calc(92vh - 110px)}
  .icon-btn{background:#e2e8f0;border:none;border-radius:10px;padding:6px 10px;cursor:pointer}
  .card.soft{padding:12px;border:1px solid #eef2f7;border-radius:12px;margin:12px 0;background:#fff}
  .chart{height:260px}
  .rpt-kpis{grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
  .kpi{background:#f8fafc;border:1px solid #eef2f7;border-radius:12px;padding:10px}
  .kpi__label{font-size:.85rem;color:#64748b}
  .kpi__value{font-weight:700;font-size:1.15rem}
  @media (min-width:700px){ .rpt-kpis{grid-template-columns:repeat(4,1fr)} }
  @media (max-width:420px){ .chart{height:220px} }
  .rpt-legend{display:flex;flex-direction:column;gap:6px;margin-top:8px}
  .rpt-legend__item{display:flex;align-items:center;gap:8px;font-size:.92rem}
  .rpt-legend__dot{width:10px;height:10px;border-radius:50%}
  .table-wrap{overflow:auto}
  .rpt-table{width:100%;border-collapse:collapse;font-size:.9rem}
  .rpt-table th,.rpt-table td{padding:8px;border-bottom:1px solid #eef2f7;text-align:right}
  .rpt-table th:first-child,.rpt-table td:first-child{text-align:left;white-space:nowrap}
  .rpt-insights{margin:0;padding-left:18px}
  .rpt-insights li{margin:4px 0}

</style>
